<?xml version="1.0" encoding="utf-8" ?>
<sqlinstruction>
	<event server="#server_ddadb#" database="#database_dda#" timeout="900">
		<executesql><![CDATA[
DECLARE @processdate datetime

Select @processdate = CURRENT_BUS_DAY 
	from BanklineFSB.dbo.BANK_TABLE 
	where SUBSYSTEM = 'DDA'

/*
update BanklineWNB.dbo.APPL1
	set BEG_BAL_LSTT = 0 
	where BEG_BAL_LSTT IS null 
	  and APPL = 'DDA'
	  and END_STT_DT_LSTT >= @processdate

update BanklineFSB.dbo.APPL1
	set BEG_BAL_LSTT = 0 
	where BEG_BAL_LSTT IS null 
	  and APPL = 'DDA'
	  and END_STT_DT_LSTT >= @processdate
*/

/* add the statements to the DDA database */
insert into DDA.dbo.DDAStmt 
	(AcctNum, StartDate, BegBal, CrCount, CrTotal, DbCount, DbTotal, EndDate, EndBal)

	select 	AcctNum = convert(bigint, SUBSTRING(Z_ID, 4, 10)), 
			StartDate = BEG_STT_DT_LSTT, 
			BegBal = IsNull(convert(money, BEG_BAL_LSTT), 0), 
			CrCount = 0, 
			CrTotal = IsNull(convert(money, CTD_CR_AMT_LSTT), 0), 
			DbCount = 0, 
			DbTotal = IsNull(convert(money, CTD_DB_AMT_LSTT), 0), 
			EndDate = END_STT_DT_LSTT, 
			EndBal = (IsNull(convert(money, BEG_BAL_LSTT), 0) 
					+ IsNull(convert(money, CTD_CR_AMT_LSTT), 0) 
					- IsNull(convert(money, CTD_DB_AMT_LSTT), 0))
		from Bankline.dbo.APPL1
		WHERE APPL = 'DDA' 
		  AND END_STT_DT_LSTT >= @processdate]]></executesql>
	</event>
</sqlinstruction>