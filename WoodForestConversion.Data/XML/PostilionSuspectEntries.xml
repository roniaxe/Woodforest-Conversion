<?xml version="1.0" encoding="utf-8" ?>
<sqlinstruction>
	<!--  Clear Suspect Entries in Postilion Database
	-->
	<event server="#server_postilion#" database="#Postilion#" timeout="2700">
		<executesql>
		BEGIN
			DECLARE @event_nr INT
			DECLARE @entity VARCHAR(30)
	
			WHILE (1=1)
		BEGIN
			SELECT TOP 1 
				@event_nr = event_nr,
				@entity = entity
			FROM support_notifications WITH (NOLOCK)
			WHERE (state = 0) AND (event_id = 33 OR event_id = 189 OR event_id = 502 OR event_id = 503)
		
			IF (@@ROWCOUNT = 0)
				BREAK
		
			DELETE FROM	support_notifications_open
			WHERE event_nr = @event_nr
		
			UPDATE support_notifications
			SET	state = 2
			WHERE event_nr = @event_nr
		
			UPDATE term
			SET condition = 0
			WHERE short_name = @entity AND condition = 2

			INSERT INTO support_event_responses	(event_nr,date_time,operator,action,add_info)
			VALUES (@event_nr, DEFAULT, 'REST\admin_postilion', 1, 'Closed by operator')
		END
		END
</executesql>
	</event>
</sqlinstruction>